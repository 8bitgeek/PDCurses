# Makefile for XCurses library

SHELL = /bin/sh

@SET_MAKE@

VER=@VER@
VER_DOT=@VER_DOT@
PDC_DIR=PDCurses-$(VER_DOT)

srcdir		=@srcdir@
VPATH		=@srcdir@
prefix		=@prefix@
exec_prefix	=$(DESTDIR)@exec_prefix@
libdir		=$(exec_prefix)/lib
bindir		=$(exec_prefix)/bin
includedir	=$(exec_prefix)/include
pdcursesdir	=./pdcurses
paneldir	=./panel
demosdir	=./demos
commondir	=./common

INSTALL		=$(srcdir)/install-sh
RANLIB		=@RANLIB@
SHLPRE = @SHLPRE@
SHLPST = @SHLPST@
SHLFILE = XCurses

ZIPFILE = pdcurs$(VER).zip
TARBALL = $(PDC_DIR).tar.gz

all ::	pdcurses demos panel

all \
clean \
distclean \
mostlyclean \
realclean ::
	cd pdcurses; $(MAKE) $(MFLAGS) $@
	cd panel; $(MAKE) $(MFLAGS) $@
	cd demos; $(MAKE) $(MFLAGS) $@
	cd tools; $(MAKE) $(MFLAGS) $@

install:
	$(INSTALL) -d -m 755 $(libdir)
	$(INSTALL) -d -m 755 $(bindir)
	$(INSTALL) -d -m 755 $(includedir)
	$(INSTALL) -c -m 644 $(srcdir)/curses.h $(includedir)/xcurses.h
	sed -e 's/#include <curses.h>/#include <xcurses.h>/' < $(srcdir)/panel.h > ./xpanel.h
	$(INSTALL) -m 644 ./xpanel.h $(includedir)/xpanel.h
	$(INSTALL) -c -m 644 $(pdcursesdir)/libXCurses.a $(libdir)/libXCurses.a
	-$(RANLIB) $(libdir)/libXCurses.a
	-$(INSTALL) -c -m 755 $(pdcursesdir)/$(SHLPRE)$(SHLFILE)$(SHLPST) $(libdir)/$(SHLPRE)$(SHLFILE)$(SHLPST)
	$(INSTALL) -c -m 644 $(paneldir)/libpanel.a $(libdir)/libXpanel.a
	-$(RANLIB) $(libdir)/libXpanel.a
	$(INSTALL) -c -m 755 ./xcurses-config $(bindir)/xcurses-config

clean ::
	rm -f config.log config.cache config.status

distclean ::
	rm -f config.log config.cache config.status
	rm -f config.h Makefile

manual:
	cd tools; $(MAKE) $(MFLAGS) $@

xcurses.h:
	ln -s curses.h $@

$(ZIPFILE): xcurses.h
	zip -y $(ZIPFILE) README INSTALL TODO Makefile.in config.h.in configure xcurses-config.in \
	configure.in config.guess config.sub install-sh aclocal.m4 \
	curses.h xcurses.h curspriv.h panel.h term.h maintain.er readme.* \
	pdcurses/README pdcurses/*.c demos/*.c demos/*.h \
	common/accommon.m4 \
	panel/README panel/*.c \
	dos/README dos/*.c dos/*.rsp dos/*.mak dos/*.lrf \
	os2/README os2/*.c os2/*.mak os2/*.lrf os2/*.def \
	x11/README x11/*.c x11/*.xbm x11/*.def x11/*.h x11/process/*.c \
	x11/process/*.c x11/process/*.h \
	win32/README win32/*.c win32/*.mak win32/*.lrf win32/*.def win32/*.ico win32/*.rc \
	doc/*.man tools/manext.c \
	pdcurses/Makefile.in pdcurses/Makefile.aix.in demos/Makefile.in panel/Makefile.in tools/Makefile.in
#	x11/thread/*.c x11/thread/*.h \
#	flexos/README flexos/*.c \
#	dos/*.ini os2/*.ini \
#	os2/*.rsp win32/*.rsp \
#	pdc64.gif makezip.cmd \

zip: $(ZIPFILE)

../$(TARBALL): xcurses.h
	(cd ..; tar cvf - $(PDC_DIR)/README $(PDC_DIR)/INSTALL $(PDC_DIR)/TODO $(PDC_DIR)/Makefile.in \
	$(PDC_DIR)/config.h.in $(PDC_DIR)/configure $(PDC_DIR)/config.guess $(PDC_DIR)/aclocal.m4 $(PDC_DIR)/common/accommon.m4 $(PDC_DIR)/xcurses-config.in \
	$(PDC_DIR)/config.sub $(PDC_DIR)/configure.in $(PDC_DIR)/install-sh $(PDC_DIR)/curses.h $(PDC_DIR)/xcurses.h \
	$(PDC_DIR)/curspriv.h $(PDC_DIR)/panel.h $(PDC_DIR)/term.h \
	$(PDC_DIR)/maintain.er $(PDC_DIR)/readme.* \
	$(PDC_DIR)/pdcurses/README $(PDC_DIR)/pdcurses/*.c $(PDC_DIR)/demos/*.c $(PDC_DIR)/demos/*.h $(PDC_DIR)/doc/*.man \
	$(PDC_DIR)/panel/README $(PDC_DIR)/panel/*.c $(PDC_DIR)/*.spec \
	$(PDC_DIR)/dos/README $(PDC_DIR)/dos/*.c $(PDC_DIR)/dos/*.rsp $(PDC_DIR)/dos/*.mak $(PDC_DIR)/dos/*.lrf \
	$(PDC_DIR)/os2/README $(PDC_DIR)/os2/*.c $(PDC_DIR)/os2/*.mak $(PDC_DIR)/os2/*.lrf $(PDC_DIR)/os2/*.def \
	$(PDC_DIR)/x11/README $(PDC_DIR)/x11/*.c $(PDC_DIR)/x11/*.xbm $(PDC_DIR)/x11/*.def $(PDC_DIR)/x11/*.h \
	$(PDC_DIR)/x11/process/*.c $(PDC_DIR)/x11/process/*.h \
	$(PDC_DIR)/win32/README $(PDC_DIR)/win32/*.c $(PDC_DIR)/win32/*.mak $(PDC_DIR)/win32/*.lrf $(PDC_DIR)/win32/*.def $(PDC_DIR)/win32/*.ico $(PDC_DIR)/win32/*.rc \
	$(PDC_DIR)/tools/manext.c \
	$(PDC_DIR)/pdcurses/Makefile.in $(PDC_DIR)/pdcurses/Makefile.aix.in $(PDC_DIR)/demos/Makefile.in $(PDC_DIR)/tools/Makefile.in \
	$(PDC_DIR)/panel/Makefile.in | gzip > $(TARBALL))
#	$(PDC_DIR)/x11/thread/*.c $(PDC_DIR)/x11/thread/*.h \
#	$(PDC_DIR)/flexos/README $(PDC_DIR)/flexos/*.c \
#	$(PDC_DIR)/dos/*.ini $(PDC_DIR)/os2/*.ini \
#	$(PDC_DIR)/os2/*.rsp  $(PDC_DIR)/win32/*.rsp \
#	$(PDC_DIR)/pdc64.gif $(PDC_DIR)/makezip.cmd \

dist: ../$(TARBALL)

rpm: ../$(TARBALL)
	rpm -ba $(srcdir)/PDCurses.spec
#
# End of makefile
#
