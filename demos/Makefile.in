# Makefile for XCurses demo programs.

SHELL		= /bin/sh

srcdir		= @srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
libdir		= $(exec_prefix)
PDCURSES_HOME	= $(srcdir)/..
PDCURSES_CURSES_H	= $(PDCURSES_HOME)/curses.h

CC		= @CC@
CFLAGS		= @CFLAGS@

CPPFLAGS	= -I$(PDCURSES_HOME) -I$(srcdir) -DXCURSES @SYS_DEFS@

CCFLAGS		= -c $(CFLAGS) $(CPPFLAGS) @MH_XINC_DIR@

LIB_DEPS	= -L$(PDCURSES_HOME)/x11 -lXCurses
LIBXCURSES	= $(PDCURSES_HOME)/x11/libXCurses.a

PANEL_LIB	= -L$(PDCURSES_HOME)/x11 -lpanel
LIBPANEL	= $(PDCURSES_HOME)/x11/libpanel.a

LINK		= @PURIFY@ $(CC)
#LDFLAGS	= $(LIB_DEPS) @LDFLAGS@ @LIBS@ @MH_XLIBS@ @MH_EXTRA_LIBS@
LDFLAGS		= $(LIBXCURSES) @LDFLAGS@ @LIBS@ @MH_XLIBS@ @MH_EXTRA_LIBS@

DEMOS 		= firework newdemo ptest rain testcurs tuidemo worm xmas

all: $(DEMOS) 

$(LIBXCURSES):
$(LIBPANEL):
	cd ../x11; $(MAKE) $(MFLAGS)

firework: firework.o $(LIBXCURSES)
	$(LINK) firework.o -o $@ $(LDFLAGS)

newdemo: newdemo.o $(LIBXCURSES)
	$(LINK) newdemo.o -o $@ $(LDFLAGS)

ptest: ptest.o $(LIBXCURSES) $(LIBPANEL)
#	$(LINK) ptest.o -o $@ $(PANEL_LIB) $(LDFLAGS)
	$(LINK) ptest.o -o $@ $(LIBPANEL) $(LDFLAGS)

rain: rain.o $(LIBXCURSES)
	$(LINK) rain.o -o $@ $(LDFLAGS)

testcurs: testcurs.o $(LIBXCURSES)
	$(LINK) testcurs.o -o $@ $(LDFLAGS)

tuidemo: tuidemo.o tui.o $(LIBXCURSES)
	$(LINK) tui.o tuidemo.o -o $@ $(LDFLAGS)

worm: worm.o $(LIBXCURSES)
	$(LINK) worm.o -o $@ $(LDFLAGS)

xmas: xmas.o $(LIBXCURSES)
	$(LINK) xmas.o -o $@ $(LDFLAGS)


firework.o: $(srcdir)/firework.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/firework.c

newdemo.o: $(srcdir)/newdemo.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/newdemo.c

ptest.o: $(srcdir)/ptest.c $(PDCURSES_HOME)/panel.h $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/ptest.c

rain.o: $(srcdir)/rain.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/rain.c

testcurs.o: $(srcdir)/testcurs.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/testcurs.c

tui.o: $(srcdir)/tui.c $(srcdir)/tui.h $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/tui.c

tuidemo.o: $(srcdir)/tuidemo.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/tuidemo.c

worm.o: $(srcdir)/worm.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/worm.c

xmas.o: $(srcdir)/xmas.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) -o $@ $(srcdir)/xmas.c

install:
	echo Does nothing at the moment

clean:
	-rm -f *.o trace $(DEMOS)

distclean: clean
	-rm -f Makefile

mostlyclean: clean

realclean: distclean

#
# This section provides for compiling and linking the
# ncurses test programs.
#
ncurses_testdir	= $(HOME)/ncurses-5.5/test

NCURSES_TESTS	= bs gdc hanoi knight tclock ncurses

ncurses_tests: $(NCURSES_TESTS)

ncurses_clean:
	-rm -f *.o trace $(NCURSES_TESTS)

NCFLAGS=-I$(ncurses_testdir)

bs: bs.o $(LIBXCURSES)
	$(LINK) bs.o -o $@ $(LDFLAGS)

gdc: gdc.o $(LIBXCURSES)
	$(LINK) gdc.o -o $@ $(LDFLAGS)

hanoi: hanoi.o $(LIBXCURSES)
	$(LINK) hanoi.o -o $@ $(LDFLAGS)

knight: knight.o $(LIBXCURSES)
	$(LINK) knight.o -o $@ $(LDFLAGS)

tclock: tclock.o $(LIBXCURSES)
	$(LINK) tclock.o -o $@ $(LDFLAGS) -lm

view: view.o $(LIBXCURSES)
	$(LINK) view.o -o $@ $(LDFLAGS)

ncurses: ncurses.o $(LIBXCURSES) $(LIBPANEL)
	$(LINK) ncurses.o -o $@ $(LDFLAGS) $(LIBPANEL)

bs.o: $(ncurses_testdir)/bs.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/bs.c

gdc.o: $(ncurses_testdir)/gdc.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/gdc.c

hanoi.o: $(ncurses_testdir)/hanoi.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/hanoi.c

knight.o: $(ncurses_testdir)/knight.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/knight.c

tclock.o: $(ncurses_testdir)/tclock.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/tclock.c

view.o: $(ncurses_testdir)/view.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/view.c

ncurses.o: $(ncurses_testdir)/ncurses.c $(PDCURSES_CURSES_H)
	$(CC) $(CCFLAGS) $(NCFLAGS) -o $@ $(ncurses_testdir)/ncurses.c
